<section class="page">
  <header>
    <h1>Auditoria (Ledger)</h1>
    <p>
      Registro imutável de eventos do tenant (create/update/delete) com hash-chain.
    </p>
  </header>

  <div class="actions">
    <label>
      Limite
      <input pInputText type="number" [ngModel]="limit()" (ngModelChange)="limit.set($event)" />
    </label>
    <button pButton type="button" (click)="load()" [disabled]="loading()">Recarregar</button>
  </div>

  <p *ngIf="loading()">Carregando...</p>
  <p class="error" *ngIf="error()">{{ error() }}</p>

  <div class="table-wrap" *ngIf="entries().length">
    <table>
      <thead>
        <tr>
          <th>Quando</th>
          <th>Ação</th>
          <th>Evento</th>
          <th>Recurso</th>
          <th>Usuário</th>
          <th>Path</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let entry of entries()">
          <td>{{ entry.occurred_at | date: "short" }}</td>
          <td class="mono">{{ entry.action }}</td>
          <td class="mono">{{ entry.event_type }}</td>
          <td class="mono">{{ entry.resource_label }}#{{ entry.resource_pk }}</td>
          <td>{{ entry.actor_username || "system" }}</td>
          <td class="mono">{{ entry.request_method }} {{ entry.request_path }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</section>

