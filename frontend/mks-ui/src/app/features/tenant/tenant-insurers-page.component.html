<section class="tenant-wrap">
  <header class="page-header">
    <div>
      <p class="badge">Operacional</p>
      <h1>Seguradoras</h1>
      <p class="subtitle">
        Cadastro de seguradoras do tenant, com referências de integração (sem segredos no banco).
      </p>
    </div>
    <button type="button" (click)="load()" [disabled]="loading()">Atualizar</button>
  </header>

  <p *ngIf="loading()" class="muted">Carregando...</p>
  <p *ngIf="error()" class="error">{{ error() }}</p>
  <p *ngIf="notice()" class="notice">{{ notice() }}</p>

  <article class="card">
    <h2>Filtros</h2>
    <div class="form-grid">
      <label>
        Busca
        <input
          type="text"
          [ngModel]="search()"
          (ngModelChange)="search.set($event)"
          [disabled]="loading()"
        />
      </label>
      <label>
        Status
        <select
          [ngModel]="statusFilter()"
          (ngModelChange)="statusFilter.set($event)"
          [disabled]="loading()"
        >
          <option value="">Todos</option>
          <option value="ACTIVE">Ativa</option>
          <option value="INACTIVE">Inativa</option>
        </select>
      </label>
      <div class="actions filter-actions">
        <button type="button" (click)="load()" [disabled]="loading()">Aplicar</button>
      </div>
    </div>
  </article>

  <article class="card">
    <h2>Nova Seguradora</h2>
    <p class="muted">
      Restrito a <strong>MANAGER</strong> e <strong>OWNER</strong>. Não armazene credenciais aqui.
      Use apenas referências de Secret Manager no futuro.
    </p>

    <div class="form-grid">
      <label>
        Nome (obrigatório)
        <input
          type="text"
          [ngModel]="name()"
          (ngModelChange)="name.set($event)"
          [disabled]="loading() || !canWrite()"
        />
      </label>
      <label>
        Razão social
        <input
          type="text"
          [ngModel]="legalName()"
          (ngModelChange)="legalName.set($event)"
          [disabled]="loading() || !canWrite()"
        />
      </label>
      <label>
        CNPJ
        <input
          type="text"
          [ngModel]="cnpj()"
          (ngModelChange)="cnpj.set($event)"
          [disabled]="loading() || !canWrite()"
        />
      </label>
      <label>
        Tipo de integração
        <select
          [ngModel]="integrationType()"
          (ngModelChange)="integrationType.set($event)"
          [disabled]="loading() || !canWrite()"
        >
          <option *ngFor="let t of integrationTypes" [value]="t.value">
            {{ t.label }}
          </option>
        </select>
      </label>
    </div>

    <div class="actions top-gap">
      <button type="button" (click)="createInsurer()" [disabled]="loading() || !canWrite()">
        Criar seguradora
      </button>
    </div>
  </article>

  <article class="card" *ngIf="editing() as insurer">
    <h2>Editando: {{ insurer.name }}</h2>
    <div class="form-grid">
      <label>
        Nome
        <input
          type="text"
          [ngModel]="editName()"
          (ngModelChange)="editName.set($event)"
          [disabled]="loading() || !canWrite()"
        />
      </label>
      <label>
        Razão social
        <input
          type="text"
          [ngModel]="editLegalName()"
          (ngModelChange)="editLegalName.set($event)"
          [disabled]="loading() || !canWrite()"
        />
      </label>
      <label>
        CNPJ
        <input
          type="text"
          [ngModel]="editCnpj()"
          (ngModelChange)="editCnpj.set($event)"
          [disabled]="loading() || !canWrite()"
        />
      </label>
      <label>
        Status
        <select
          [ngModel]="editStatus()"
          (ngModelChange)="editStatus.set($event)"
          [disabled]="loading() || !canWrite()"
        >
          <option value="ACTIVE">Ativa</option>
          <option value="INACTIVE">Inativa</option>
        </select>
      </label>
      <label>
        Tipo de integração
        <select
          [ngModel]="editIntegrationType()"
          (ngModelChange)="editIntegrationType.set($event)"
          [disabled]="loading() || !canWrite()"
        >
          <option *ngFor="let t of integrationTypes" [value]="t.value">
            {{ t.label }}
          </option>
        </select>
      </label>
    </div>

    <div class="actions top-gap">
      <button type="button" (click)="saveEdit()" [disabled]="loading() || !canWrite()">
        Salvar alterações
      </button>
      <button type="button" class="secondary" (click)="cancelEdit()" [disabled]="loading()">
        Cancelar
      </button>
    </div>
  </article>

  <article class="card">
    <h2>Lista de Seguradoras</h2>

    <p *ngIf="insurers().length === 0" class="muted">
      Nenhuma seguradora cadastrada ainda.
    </p>

    <table class="table" *ngIf="insurers().length > 0">
      <thead>
        <tr>
          <th>ID</th>
          <th>Nome</th>
          <th>Status</th>
          <th>Integração</th>
          <th>CNPJ</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let insurer of insurers()">
          <td>{{ insurer.id }}</td>
          <td>{{ insurer.name }}</td>
          <td>
            <span class="pill" [class.inactive]="insurer.status === 'INACTIVE'">
              {{ insurer.status === "ACTIVE" ? "Ativa" : "Inativa" }}
            </span>
          </td>
          <td>{{ insurer.integration_type }}</td>
          <td>{{ insurer.cnpj || "-" }}</td>
          <td class="actions compact">
            <button type="button" (click)="startEdit(insurer)" [disabled]="loading() || !canWrite()">
              Editar
            </button>
            <button
              type="button"
              class="danger"
              (click)="deactivate(insurer)"
              [disabled]="loading() || !canWrite()"
            >
              Desativar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </article>
</section>

