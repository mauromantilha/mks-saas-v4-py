<p-card styleClass="panel-card ai-suggestions-card ai-suggestions-aura-light">
  <div class="card-head">
    <div>
      <h2>Monitor IA e sugestões</h2>
      <p class="muted">Recomendações priorizadas por severidade para ação rápida.</p>
    </div>

    <button pButton type="button" class="btn-secondary" (click)="refresh()" [disabled]="loading()">
      {{ loading() ? "Atualizando..." : "Atualizar" }}
    </button>
  </div>

  <ng-container *ngIf="loading() && suggestions().length === 0">
    <div class="suggestion-skeletons">
      <p-skeleton width="100%" height="7.5rem"></p-skeleton>
      <p-skeleton width="100%" height="7.5rem"></p-skeleton>
      <p-skeleton width="100%" height="7.5rem"></p-skeleton>
    </div>
  </ng-container>

  <p *ngIf="!loading() && visibleSuggestions().length === 0" class="muted">
    Nenhuma sugestão disponível para este tenant no momento.
  </p>

  <div class="suggestions-list" *ngIf="visibleSuggestions().length > 0">
    <article class="suggestion-item" *ngFor="let item of visibleSuggestions()">
      <div class="suggestion-head">
        <h3>{{ item.title }}</h3>
        <div class="tags-row">
          <p-tag [value]="severityLabel(item.severity)" [severity]="severityTag(item.severity)"></p-tag>
          <p-tag [value]="severityLabel(item.priority)" [severity]="priorityTag(item.priority)"></p-tag>
          <p-tag [value]="item.scope || 'dashboard'" severity="info"></p-tag>
        </div>
      </div>

      <p class="suggestion-body">{{ item.body }}</p>

      <div class="suggestion-actions">
        <button pButton type="button" class="btn-primary" (click)="openAIAssistant()">
          Abrir MKS Advisor
        </button>
        <button
          pButton
          type="button"
          class="btn-link"
          *ngIf="hasDetailLink(item)"
          (click)="openDetail(item)"
        >
          Ver detalhe
        </button>
      </div>
    </article>
  </div>

  <p *ngIf="error()" class="error-text">{{ error() }}</p>
</p-card>
